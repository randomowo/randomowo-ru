{% extends "admin-cinema.html" %}

{% block head_js %}
{{ block.super }}
<script async src="/static/admin/js/new-el.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock %}

{% block body %}
<div class="title">
    Film list:
</div>
<div class="centered">
    {{films_watched}}/{{films_count}}
</div>
<div class="content-list">
    {% include "admin/cinema/add/add-film.html" %}
    {% for film in films %}
    <div id="film-block-{{film.id}}"
         class="film-block"
         onclick="toggle('film-content-{{film.title}}', 'film-block-{{film.id}}')"
         aria-expanded="false">
        <a href="#film-block-{{film.id}}">{{film.title}}</a>
    </div>
    <div id="film-content-{{film.title}}"
         style="display:none;">
        <form action="/admin/cinema/filmlist/" method="post">
            {% csrf_token %}
            <div class="film-text">
                <input type="text"
                       id="film-title"
                       name="film-title"
                       placeholder="Title"
                       value="{{film.title}}" />
            </div>
            <div class="film-text">
                <input type="text"
                       id="film-url"
                       name="film-url"
                       placeholder="Url to film page"
                       value="{{film.url}}" />
            </div>
            <div class="film-text">
                <input type="text"
                       id="film-director"
                       name="film-director"
                       placeholder="Director"
                       value="{{film.director}}" />
            </div>
            <div class="film-number">
                <input type="number"
                       id="film-year"
                       name="film-year"
                       placeholder="Year"
                       min="1900"
                       max="{{next_year}}"
                       step="1"
                       value="{{film.year}}" />
            </div>
            <div class="film-label">
                <label for="film-is-watched">Is watched?</label>
            </div>
            <div class="film-checkbox">
                <input type="checkbox"
                       id="film-is-watched"
                       name="film-is-watched"
                       {% if film.is_watched %} checked {% endif %} />
            </div>
            <div class="film-label">
                <label for="film-is-movie">Is a movie?</label>
            </div>
            <div class="film-checkbox">
                <input type="checkbox"
                       id="film-is-movie{{film.id}}"
                       name="film-is-movie"
                       {% if film.is_movie %} checked {% endif %} />
            </div>
            {% if not film.is_movie %}
            <div class="film-season-block{{film.id}}" style="{% if not film.is_movie %}display:none;{% endif %}">
                {% for season, episodes in film.serial %}
                <div class="film-number">
                    <input type="number"
                           id="film-season-number"
                           name="film-season-number"
                           min="1"
                           value="{{season}}" />
                </div>
                {% for ep in episodes %}
                <div class="film-episode-block_{{ep.id}}">
                    <div class="film-number">
                        <input type="number"
                               id="film-episode-number"
                               name="film-episode-number"
                               placeholder="No."
                               min="1"
                               value="{{ep.number}}" />
                    </div>
                    <div class="film-text">
                        <input type="text"
                               id="film-episode-title"
                               name="film-episode-title"
                               placeholder="Episode title"
                               value="{{ep.title}}" />
                    </div>
                    <div class="film-number">
                        <input type="number"
                               id="film-episode-duration"
                               name="film-episode-duration"
                               placeholder="Duration"
                               value="{{ep.duration}}" />
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </form>
    </div>
    {% endfor %}
</div>
<script>
    $('#film-is-movie').click(function() {
        $("#film-season-block").toggle(!this.checked);
    });
    {% for film in films %}
    {% if not film.is_movie %}
    $('#film-is-movie{{film.id}}').click(function() {
        $("#film-season-block{{film.id}}").toggle(this.checked);
    });
    {% endif %}
    {% endfor %}
</script>
{% endblock %}
